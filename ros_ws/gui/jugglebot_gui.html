<!DOCTYPE html>
<html>
<head>
    <!-- Include the font awesome library for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <title>ROS Test Connection</title>

    <!-- Three.js Library as ES Module -->
    <script type="importmap">
        {
          "imports": {
            "three": "https://unpkg.com/three@v0.159.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@v0.159.0/examples/jsm/"
          }
        }
    </script>
    <script type="module" src="3dplotter.js"></script>

    <script type="text/javascript" src="lib/roslib.min.js"></script>
    <script type="text/javascript">
        window.onload = function () {
            // ################################################################## //
            //                          Connect to ROS                            //
            // ################################################################## //

            var ros = new ROSLIB.Ros({
                url : 'ws://localhost:9090'
            });

            ros.on('connection', function() {
                console.log('Connected to websocket server.');
            });

            ros.on('error', function(error) {
                console.log('Error connecting to websocket server: ', error);
            });

            ros.on('close', function() {
                console.log('Connection to websocket server closed.');
            });

            // ################################################################## //
            //                      Initialize the 3D Plotter                     //
            // ################################################################## //

            initPlotter();

            // ################################################################## //
            //                  Subscribe to /rosout (for logging)                //
            // ################################################################## //

            // Get the console div element
            var consoleDiv = document.getElementById('ros-console');

            // Set a limit for how many messages are stored in the console
            var maxMessages = 100;

            // Subscribe to the /rosout topic
            var listener = new ROSLIB.Topic({
                ros: ros,
                name: '/rosout',
                messageType: 'rcl_interfaces/msg/Log'
            });

            // Define a function to map the log level to a color
            function getLogLevelColor(level) {
                switch(level) {
                    case 10: return '#808080'; // DEBUG: Grey
                    case 20: return '#000000'; // INFO: Black
                    case 30: return '#FFA500'; // WARN: Orange
                    case 40: return '#FF4500'; // ERROR: Red-Orange
                    case 50: return '#FF0000'; // FATAL: Red
                    default: return '#000000'; // Default color for unknown levels
                }
            }

            // Add a listener function to /rosout
            listener.subscribe(function(message) {
                // Check if the message level is enabled
                if (!document.getElementById(`log-level-${message.level}`).checked) {
                    return; // Do nothing if the message level is not enabled
                }

                // Set the color of the console div based on the log level
                var logColor = getLogLevelColor(message.level);

                // Get the current time
                var currentDate = new Date();
                var timestamp = currentDate.getHours() + ':' + currentDate.getMinutes() + ':' + currentDate.getSeconds(); 

                // Create a new log entry
                var logEntry = document.createElement('div');
                logEntry.textContent = `[${timestamp}] [${message.name}]: ${message.msg}`;
                logEntry.style.color = logColor;

                // Add bold font and background color for FATAL messages
                if (message.level === 50) {
                    logEntry.style.fontWeight = 'bold';
                    logEntry.style.backgroundColor = '#ffcccc'; // Light red background
                    logEntry.style.padding = '2px';
                }

                // Add a tolerance in case the browser rounds the scroll height
                var scrollTolerance = 5;

                // Check if the console is scrolled to the bottom before adding new message
                var isScrolledToBottom = consoleDiv.scrollHeight - consoleDiv.scrollTop - consoleDiv.clientHeight < scrollTolerance;

                // Add the log entry to the console
                consoleDiv.appendChild(logEntry);

                // Remove the oldest log entry if the console is full
                if (consoleDiv.childElementCount > maxMessages) {
                    consoleDiv.removeChild(consoleDiv.firstChild);
                }

                // Use requestAnimationFrame to defer the scrolling
                requestAnimationFrame(function() {
                    if (isScrolledToBottom) {
                        consoleDiv.scrollTop = consoleDiv.scrollHeight;
                    }
                });
            });
            
            // ################################################################## //
            //                    Querying for Active ROS Topics                  //
            // ################################################################## //

            var excludedTopics = [
                "/client_count",
                "/connected_clients",
                "/parameter_events",
                "/rosout",
            ]
            
            var topicsStats = {} // Dictionary to store stats for each Topic

            var topicTypeClient = new ROSLIB.Service({
                ros : ros,
                name : '/rosapi/topics',
                serviceType : 'rosapi/Topics'
            });

            function updateTopicListAndTypes() {
                var request = new ROSLIB.ServiceRequest(); // Empty request for Topics call
                topicTypeClient.callService(request, function(response) {
                    subscribeToTopics(response.topics, response.types);
                });
            }

            function subscribeToTopics(topics, types) {
                // First, mark all topics as inactive
                Object.keys(topicsStats).forEach(function(topic) {
                    if (topicsStats[topic]) {
                        topicsStats[topic].isActive = false;
                    }
                });

                // Iterate through each topic
                for (var i = 0; i < topics.length; i++) {
                    var topicName = topics[i];
                    var topicType = types[i];

                    // Skip topics that are excluded
                    if (excludedTopics.includes(topicName)) {
                        continue;
                    }

                    // If not already subscribed, initialize stats and subscribe
                    if (!topicsStats[topicName]) {
                        topicsStats[topicName] = {
                            topicType: topicType,
                            lastReceived: null,
                            messageCount: 0,
                            messageRate: 0,
                            startTime: Date.now(),
                            isActive: true,
                            subscriber: null // To store the subscriber object
                        };
                    } else {
                        // Mark the topic as active
                        topicsStats[topicName].isActive = true;
                    }

                    // Subscribe to the topic if not already subscribed
                    if (!topicsStats[topicName].subscriber) {
                        var topicSubscriber = new ROSLIB.Topic({
                            ros: ros,
                            name: topicName,
                            messageType: topicType
                        });

                        topicSubscriber.subscribe((function(topicName) {
                            return function(message) {
                                var now = new Date().getTime();
                                var stats = topicsStats[topicName];
                                stats.lastReceived = now;
                                stats.messageCount++;
                                var timeElapsed = (now - stats.startTime) / 1000; // Time in seconds
                                stats.messageRate = stats.messageCount / timeElapsed;
                            };
                        })(topicName));

                        // Store the subscriber in the stats
                        topicsStats[topicName].subscriber = topicSubscriber;
                    }
                }
            }

            function cleanupInactiveTopics() {
                Object.keys(topicsStats).forEach(function(topic) {
                    var stats = topicsStats[topic];
                    if (stats && !stats.isActive) {
                        // Unsubscribe from the topic
                        if (stats.subscriber) {
                            stats.subscriber.unsubscribe();
                        }
                        // Remove the topic's stats
                        delete topicsStats[topic];
                    }
                });
            }

            function updateTopicStatsTable() {
                var tableBody = document.getElementById('topic-stats-table-body');
                tableBody.innerHTML = ''; // Clear the table rows

                // Iterate through each topic and create a new row
                Object.keys(topicsStats).forEach(function(topic) {
                    var stats = topicsStats[topic];
                    if (stats.isActive) {
                        var row = tableBody.insertRow();

                        // Remove '/jugglebot' prefix from topic name, if it exists
                        // var displayTopicName = topic.startsWith('/jugglebot') ? topic.substring('/jugglebot'.length) : topic;
                        var displayTopicName = topic;

                        // Topic Name
                        var cellTopic = row.insertCell(0);
                        cellTopic.textContent = displayTopicName;

                        // Last Message Time
                        var cellLastMessageTime = row.insertCell(1);
                        var lastMessageAgo = stats.lastReceived ? (Date.now() - stats.lastReceived) : 'N/A';
                        cellLastMessageTime.textContent = lastMessageAgo;

                        // Average Message Rate
                        var cellMessageRate = row.insertCell(2);
                        var rate = stats.messageRate ? stats.messageRate : 0;
                        cellMessageRate.textContent = rate.toFixed(2);

                        // Set the color of the message rate
                        if (rate >= 20) {
                            cellMessageRate.classList.add('rate-green');
                        } else if (rate >= 10 && rate < 20) {
                            cellMessageRate.classList.add('rate-yellow');
                        } else {
                            cellMessageRate.classList.add('rate-red');
                        }
                    }
                });
            }

            // Function to call all functions needed to update the stats table
            function updateStats() {
                updateTopicListAndTypes();
                cleanupInactiveTopics();
                updateTopicStatsTable();
            }

            setInterval(updateStats, 1000); // Periodically update the topic list (rate is in ms)

            // ################################################################## //
            //                      Subscribe to Robot State                      //
            // ################################################################## //

            var robotStateTopic = new ROSLIB.Topic({
                ros : ros,
                name : 'robot_state_topic',
                messageType : 'jugglebot_interfaces/msg/RobotStateMessage'
            });

            robotStateTopic.subscribe(function(message) {
                // If the robot is homed, enable the control mode buttons
                var homeButton = document.getElementById('home-btn');
                var homeButtonIcon = homeButton.querySelector('.button-icon i');

                if (message.is_homed) {
                    document.getElementById('spacemouse-control-button').disabled = false;
                    document.getElementById('pattern-control-button').disabled = false;
                    document.getElementById('jogging-control-button').disabled = false;

                    // Change the "home" button, since we no longer need to home the robot
                    homeButton.querySelector('.button-text').textContent = 'Center Robot';
                    homeButtonIcon.className = 'fa-solid fa-crosshairs';
                    homeButton.setAttribute('is-homed', 'true');
                }
                else if (!message.is_homed) {
                    // If the robot is not homed, disable the control mode buttons
                    document.getElementById('spacemouse-control-button').disabled = true;
                    document.getElementById('pattern-control-button').disabled = true;
                    document.getElementById('jogging-control-button').disabled = true;

                    // Change the "home" button, since we need to home the robot
                    homeButton.querySelector('.button-text').textContent = 'Home';
                    homeButtonIcon.className = 'fa-solid fa-house-chimney';
                    homeButton.setAttribute('is-homed', 'false');
                }
                else {
                    console.log(message);
                }
            });

            // ################################################################## //
            //                    Interfacing with Pose Topic                     //
            // ################################################################## //

            var poseTopic = new ROSLIB.Topic({
                ros : ros,
                name : 'platform_pose_topic',
                messageType : 'geometry_msgs/msg/Pose'
            });

            // Initialize current pose to null
            var currentPose = null;

            poseTopic.subscribe(function(message) {
                // Store the current pose
                currentPose = message;
            });

            // Method to adjust the current pose
            function adjustPose(deltaX, deltaY, deltaZ) {
                if (currentPose) {
                    currentPose.position.x += deltaX;
                    currentPose.position.y += deltaY;
                    currentPose.position.z += deltaZ;
                }

                console.log(currentPose)

                // Publish the new pose
                poseTopic.publish(currentPose);
            }

            // Method to set the current pose
            function setPose(x, y, z) {
                if (currentPose) {
                    currentPose.position.x = x;
                    currentPose.position.y = y;
                    currentPose.position.z = z;
                    currentPose.orientation.x = 0; // Just have flat orientation for now
                    currentPose.orientation.y = 0;
                    currentPose.orientation.z = 0;
                    currentPose.orientation.w = 1;
                }
                else {
                    // If currentPose is null, construct a new pose message
                    currentPose = new ROSLIB.Message({
                        position: {
                            x: x,
                            y: y,
                            z: z
                        },
                        orientation: {
                            x: 0,
                            y: 0,
                            z: 0,
                            w: 1
                        }
                    });
                }

                // Publish the new pose
                poseTopic.publish(currentPose);
            }

            // ################################################################## //
            //                     Calling a Trigger Service                      //
            // ################################################################## //

            // A few services are Trigger types, so reuse this function
            function callTriggerService(serviceName) {
                var service = new ROSLIB.Service({
                    ros : ros,
                    name : serviceName,
                    serviceType : 'std_srvs/srv/Trigger'
                });

                var request = new ROSLIB.ServiceRequest(); // Empty request for Trigger call

                service.callService(request, function(response) {
                    console.log('Received response for service ' + serviceName + ": ", response);
                }, function(error) {
                    console.log('Service call failed: ', error);
                });
            }

            // ################################################################## //
            //                        Sending Control Mode                        //
            // ################################################################## //

            function sendControlMode(mode) {
                var cmdTopic = new ROSLIB.Topic({
                    ros : ros,
                    name : 'control_state_topic',
                    messageType : 'std_msgs/msg/String'
                });

                var message = new ROSLIB.Message({
                    data : mode
                });

                cmdTopic.publish(message);
            }

            // ################################################################## //
            //                        Define Service Clients                      //
            // ################################################################## //

            var odriveService = new ROSLIB.Service({
                ros : ros,
                name : 'odrive_command',
                serviceType : 'jugglebot_interfaces/srv/ODriveCommandService'
            });

            // ################################################################## //
            //                       Define Service Requests                      //
            // ################################################################## //

            var rebootODrivesRequest = new ROSLIB.ServiceRequest({
                command : 'reboot_odrives'
            });

            var clearODriveErrorsRequest = new ROSLIB.ServiceRequest({
                command : 'clear_errors'
            });

            // ################################################################## //
            //                           Button Listeners                         //
            // ################################################################## //

            document.getElementById('home-btn').addEventListener('click', function() {
                var isHomed = this.getAttribute('is-homed');

                if (isHomed === 'true') {
                    // If the robot is homed, send a command to center the robot
                    setPose(0, 0, 140);
                }
                else if (isHomed === 'false') {
                    // If the robot is not homed, send a command to home the robot
                    callTriggerService('/home_robot');

                    // Also send a pose command so the topic isn't empty
                    setPose(0, 0, 0);
                }
                else {
                    console.log('Invalid isHomed value: ', isHomed);
                }
            });

            document.getElementById('end-session-btn').addEventListener('click', function() {
                callTriggerService('/end_session');
            });

            document.getElementById('odrive-reboot-btn').addEventListener('click', function() {
                odriveService.callService(rebootODrivesRequest, function(response) {
                    console.log('Received response: ', response);
                }, function(error) {
                    console.log('ODrive reboot service call failed: ', error);
                });
            });

            document.getElementById('odrive-clear-errors-btn').addEventListener('click', function() {
                odriveService.callService(clearODriveErrorsRequest, function(response) {
                    console.log('Received response: ', response);
                }, function(error) {
                    console.log('ODrive clear errors service call failed: ', error);
                });
            });

            // Define an array of control modes
            const controlModes = ['spacemouse', 'jogging', 'pattern'];

            // Initialize the control state to null
            var control_state = null;

            // Define a function to handle control button clicks
            function handleControlButtonClick(mode) {
                return function() {
                    if (this.disabled || control_state === mode) {
                        return; // Do nothing if button is disabled or already in this control mode
                    }

                    // Switch to the selected control mode
                    control_state = mode;
                    this.style.backgroundColor = '#4CAF50'; // Green for active control mode

                    // Send command to ROS
                    sendControlMode(mode);

                    // Grey-out the other buttons
                    controlModes.forEach(otherMode => {
                        if (otherMode !== mode) {
                            document.getElementById(`${otherMode}-control-button`).style.backgroundColor = '#aaaaaa'; // AHHHH!
                        }
                    });

                    // If selected mode is not jogging, disable the jogging buttons
                    if (mode !== 'jogging') {
                        setJoggingButtonsEnabled(false);
                    }
                    else {
                        setJoggingButtonsEnabled(true);
                    }
                };
            }

            // Attach the event listeners to the control mode buttons (Jogging, Spacemouse, Pattern etc) 
            controlModes.forEach(mode => {
                document.getElementById(`${mode}-control-button`).addEventListener('click', handleControlButtonClick(mode));
            });
            
            // To clear the console
            document.getElementById('clear-console-btn').addEventListener('click', function() {
                var consoleDiv = document.getElementById('ros-console');
                consoleDiv.innerHTML = '';
            });
            
            // For jogging buttons
            var amountToJogBy = 10.0 // mm

            function setJoggingButtonsEnabled(enabled) {
                var joggingButtons = document.querySelectorAll('#jogging-buttons button');
                joggingButtons.forEach(button => {
                    button.disabled = !enabled;
                });
            }

            document.getElementById('jog-x-pos').addEventListener('click', function() {adjustPose(amountToJogBy, 0, 0);});
            document.getElementById('jog-x-neg').addEventListener('click', function() {adjustPose(-amountToJogBy, 0, 0);});
            document.getElementById('jog-y-pos').addEventListener('click', function() {adjustPose(0, amountToJogBy, 0);});
            document.getElementById('jog-y-neg').addEventListener('click', function() {adjustPose(0, -amountToJogBy, 0);});
            document.getElementById('jog-z-pos').addEventListener('click', function() {adjustPose(0, 0, amountToJogBy);});
            document.getElementById('jog-z-neg').addEventListener('click', function() {adjustPose(0, 0, -amountToJogBy);});
        
            // ################################################################## //
            //                           Slider Listeners                         //
            // ################################################################## //

            var slidersTopic = new ROSLIB.Topic({
                ros : ros,
                name : 'pattern_control_topic',
                messageType : 'jugglebot_interfaces/msg/PatternControlMessage'
            });

            function publishSliderValues() {
                var message = new ROSLIB.Message({
                    radius: Number(document.getElementById('slider-radius').value),
                    freq: Number(document.getElementById('slider-freq').value),
                    z_offset: Number(document.getElementById('slider-z-offset').value),
                    cone_height: Number(document.getElementById('slider-cone-height').value)
                });

                slidersTopic.publish(message);
            }

            // Add event listeners to the sliders
            ['slider-radius', 'slider-freq', 'slider-z-offset', 'slider-cone-height'].forEach(sliderId => {
                document.getElementById(sliderId).addEventListener('input', function() {
                    var sliderValue = document.getElementById(`${sliderId}-value`);
                    sliderValue.textContent = this.value;
                    publishSliderValues();
                });
            });
        };
    </script>

    <style>
        /* Style for the main container */
        #main-container {
            margin: 10px;
            display: flex; /* Make the div element a flex container */
            flex-direction: column; /* Stack items vertically */
        }

        #container-row {
            display: flex;
            justify-content: flex-start;
            margin-bottom: 10px;
        }

        /* Style for the 3D plotter */
        #plot-3d {
            width: 1000px;
            height: 720px;
            border: 2px solid #000000; /* Border color and thickness */
            background-color: #f5f5f5; /* Background color of the box */
            margin: 10px; /* Space outside the box */
        }

        /* Style for the outer button group */
        #button-container {
            display: flex; /* Make the div element a flex container */
            flex-direction: column; /* Stack items vertically */
            align-items: center; /* Center items horizontally */
            border: 2px solid #000000; /* Border color and thickness */
            width: 380px;
            padding: 5px; /* Space inside the box */
            margin: 10px; /* Space outside the box */
            background-color: #f5f5f5; /* Background color of the box */
        }

        /* Style for the ROS logging console */
        #ros-console {
            width: 980px;
            height: 200px;
            overflow-y: scroll;
            border: 2px solid #000000; /* Border color and thickness */
            background-color: #f5f5f5; /* Background color of the box */
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #000000;
            padding: 10px;
            margin: 10px;
        }

        /* Style for the log level filters */
        #log-level-filters {
            width: fit-content;
            padding: 10px;
            margin: 10px;
            border: 2px solid #000000; /* Border color and thickness */
            background-color: #f5f5f5; /* Background color of the box */
            font-family: 'Courier New', monospace;
            font-size: 20px;
        }

        /* Style for each log level filter */
        #log-level-filters div {
            margin-bottom: 5px; /* Space between each filter */
        }

        /* Style for the log level filter checkboxes */
        .log-level {
            transform: scale(1.5); /* Make the checkboxes bigger */
            margin-right: 5px; /* Space between checkbox and label */
        }

        /* Style for the labels to match log level colors */
        #log-level-10 + label {
            color: #808080; /* Grey for DEBUG */
        }
        #log-level-20 + label {
            color: #000000; /* Black for INFO */
        }
        #log-level-30 + label {
            color: #FFA500; /* Orange for WARN */
        }
        #log-level-40 + label {
            color: #FF4500; /* Red-Orange for ERROR */
        }
        #log-level-50 + label {
            color: #FF0000; /* Red for FATAL */
            background-color: #ffcccc; /* Light red background */
            padding: 2px;
            font-weight: bold;
        }

        /* Style for the topic stats table */
        #topic-stats-table {
            margin-top: 10px;
            border-collapse: collapse;
            width: 100%;
        }

        #topic-stats-table, #topic-stats-table th, #topic-stats-table td {
            border: 1px solid black;
        }

        #topic-stats-table th, #topic-stats-table td {
            padding: 8px;
            text-align: left;
        }

        #topic-stats-table th {
            background-color: #f2f2f2;
        }

        /* Style for the centre-aligned Topic table rows (last two) */
        #topic-stats-table th:nth-child(2),
        #topic-stats-table th:nth-child(3),
        #topic-stats-table td:nth-child(2),
        #topic-stats-table td:nth-child(3) {
            text-align: center;
        }

        /* Style for each colour in the topic stats table */
        .rate-green {
            color: #008000; /* Green */
        }

        .rate-yellow {
            color: #FFA500; /* Orange */
        }

        .rate-red {
            color: #FF0000; /* Red */
        }

        /* Style for the control buttons */
        #control-buttons {
            display: flex; /* Make the div element a flex container */
            flex-direction: column; /*Stack items vertically */
            width: fit-content;
            align-items: center; /* Center items vertically */
            border: 2px solid #000000; /* Border color and thickness */
            padding: 5px; /* Space inside the box */
            margin: 5px; /* Space outside the box */
            background-color: #f5f5f5; /* Background color of the box */
        }

        /* Style for the odrive command buttons */
        #odrive-buttons {
            display: flex; /* Make the div element a flex container */
            flex-direction: column; /*Stack items vertically */
            font-size: 0.8em; /* Make the text smaller */
            width: fit-content;
            align-items: center; /* Center items vertically */
            border: 2px solid #000000; /* Border color and thickness */
            padding: 5px; /* Space inside the box */
            margin: 5px; /* Space outside the box */
            background-color: #f5f5f5; /* Background color of the box */
        }

        /* Style for the end-session button */
        #end-session-btn {
            background-color: #f44336; /* Red color */
        }
        #end-session-btn:hover {
            background-color: #d32f2f; /* Darker red color */
        }

        /* Style for the clear console button */
        #clear-console-btn {
            margin-top: 15px; /* Space above the box */
        }

        /* Style for the jog buttons */
        #jog-x-pos, #jog-x-neg {
            background-color: rgb(252, 66, 66);
        }

        #jog-y-pos, #jog-y-neg {
            background-color: rgb(60, 148, 60);
        }

        #jog-z-pos, #jog-z-neg {
            background-color: rgb(92, 92, 255);
        }

        /* Style for disabled jog buttons */
        #jog-x-pos:disabled, #jog-x-neg:disabled, #jog-y-pos:disabled, #jog-y-neg:disabled, #jog-z-pos:disabled, #jog-z-neg:disabled {
            filter:saturate(50%); /* Grey out the buttons */
            color: #f7f7f7; /* Darker text color */
        }

        /* Style for the jogging buttons container */
        #jogging-buttons, #control-mode-buttons {
            display: flex; /* Make the div element a flex container */
            width: fit-content;
            flex-direction: column; /* Stack rows vertically */
            align-items: center; /* Center rows horizontally */
            border: 2px solid #3f3f3f; /* Border color and thickness */
            padding: 5px; /* Space inside the box */
            margin: 5px; /* Space outside the box */
            background-color: #f5f5f5; /* Background color of the box */
        }

        /* Style for each row of buttons */
        .button-row {
            display: flex; /* Make each row a flex container */
            flex-direction: row; /* Align buttons horizontally in the row */
            justify-content: space-between; /* Space out buttons in the row */
            margin-bottom: 5px; /* Space between rows */
            margin-right: 10ps; /* Space between buttons within a row */
        }

        /* Style for disabled buttons */
        button:disabled{
            background-color: #cccccc; /* Grey color */
            color: #666666; /* Darker text color */
            cursor: not-allowed;
        }

        /* Hover effects for buttons */
        button:hover {
            background-color: #919191;
        }

        button {
            border-radius: 10px;
            display: flex; /* Make the button elements flex containers */
            flex-direction: column; /* Stack items vertically */
            align-items: center; /* Center items horizontally */
            justify-content: center; /* Center items vertically */
            margin: 5px;
            padding: 10px;
            font-size: 16px;
            border: none;
            color: #f7f7f7;
            background-color: #666666; /* Grey color */
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .button-icon {
            /* Style for the icon */
            font-size: 24px; /* Icon size */
            margin-bottom: 5px; /* Space between icon and text */
        }

        .button-text {
            /* Style for the text */
            font-size: 16px; /* Text size */
        }

        /* Style for the pattern control sliders */
        /* Style for the pattern control sliders container */
        #pattern-control-sliders {
            text-align: center; /* Center align everything */
            border: 2px solid #000000; /* Add border around the container */
            padding: 10px; /* Padding inside the box */
            margin: 5px auto; /* Center the box with automatic horizontal margins */
            width: 80%; /* Adjust width as needed */
        }

        #pattern-control-sliders h3 {
            margin-top: 5px; /* Minimal space above heading */
            margin-bottom: 5px; /* Minimal space below heading */
        }

        #pattern-control-sliders div {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            margin-bottom: 10px; /* Space between each slider div */
        }

        /* Style for labels */
        #pattern-control-sliders label {
            flex: 0 0 30%; /* Label takes up 30% of the space, not growing or shrinking */
            text-align: left; /* Align the text to the left */
        }

        /* Style for sliders */
        #pattern-control-sliders input[type="range"] {
            flex-grow: 1; /* Slider takes the remaining space */
        }

        /* Style for slider values */
        #pattern-control-sliders span {
            margin-left: 10px; /* Space between slider and its value */
        }
    </style>
</head>
<body>
    <div id="main-container">

        <div id="container-row">
            <!-- 3D Plotter -->
            <div id="plot-3d"></div>

            <!-- Button (and slider) Container -->
            <div id="button-container">
                <!-- Control buttons -->
                <div id="control-buttons">
                    <!-- Container for the first two buttons (Home and End Session)-->
                    <div class="button-row">
                        <button id="home-btn">
                            <span class="button-icon"><i class="fa-solid fa-house-chimney"></i></span>
                            <span class="button-text">Home</span>
                        </button>
                        <button id="end-session-btn">
                            <span class="button-icon"><i class="fa-solid fa-skull"></i></span>
                            <span class="button-text">End Session</span>
                        </button>
                    </div>
                </div>
                
                <!-- Row for Jogging and Control Mode buttons -->
                <div id="container-row">
                    <!-- Jogging buttons -->
                    <div id="jogging-buttons">
                        <!-- Add a title to the jog button group -->
                        <h3>Jogging</h3>
                        <div class="button-row">
                            <button id="jog-x-pos" disabled>X +</button>
                            <button id="jog-x-neg" disabled>X -</button>
                        </div>
                        <div class="button-row">
                            <button id="jog-y-pos" disabled>Y +</button>
                            <button id="jog-y-neg" disabled>Y -</button>
                        </div>
                        <div class="button-row">
                            <button id="jog-z-pos" disabled>Z +</button>
                            <button id="jog-z-neg" disabled>Z -</button>
                        </div>
                    </div>

                    <!-- Container for the spacemouse control button -->
                    <div id="control-mode-buttons">
                        <h3>Control Mode</h3>
                        <button id="jogging-control-button" disabled>Jogging</button>
                        <button id="spacemouse-control-button" disabled>SpaceMouse</button>
                        <button id="pattern-control-button" disabled>Pattern</button>
                    </div>
                </div>

                <!-- Row for sliders used with the pattern control mode -->
                <div id="pattern-control-sliders">
                    <h3>Pattern Control</h3>
                    <!-- Slider for radius of pattern -->
                    <div>
                        <label for="slider-radius">Radius (mm):</label>
                        <input type="range" id="slider-radius" name="slider-radius" min="0" max="140" value="100.0" step="5.0">
                        <span id="slider-radius-value">100.0</span>
                    </div>

                    <!-- Slider for frequency of pattern -->
                    <div>
                        <label for="slider-freq">Freq (Hz):</label>
                        <input type="range" id="slider-freq" name="slider-freq" min="0.05" max="1.0" value="0.5" step="0.05">
                        <span id="slider-freq-value">0.5</span>
                    </div>

                    <!-- Slider for z-offset of pattern -->
                    <div>
                        <label for="slider-z-offset">z offset (mm):</label>
                        <input type="range" id="slider-z-offset" name="slider-z-offset" min="50" max="200" value="140.0" step="10.0">
                        <span id="slider-z-offset-value">140.0</span>
                    </div>

                    <!-- Slider for cone height -->
                    <div>
                        <label for="slider-cone-height">Cone height (mm):</label>
                        <input type="range" id="slider-cone-height" name="slider-cone-height" min="50" max="1000" value="150.0" step="10.0">
                        <span id="slider-cone-height-value">150.0</span>
                    </div>

                </div>

                <!-- Buttons for interfacing with the ODrives -->
                <div id="odrive-buttons">
                    <div class="button-row">
                        <button id="odrive-reboot-btn">
                            <span class="button-icon"><i class="fa-solid fa-power-off"></i></span>
                            <span class="button-text">Reboot ODrives</span>
                        </button>

                        <button id="odrive-clear-errors-btn">
                            <span class="button-icon"><i class="fa-solid fa-xmark"></i></span>
                            <span class="button-text">Clear ODrive Errors</span>
                    </div>
                </div>

            </div>

            <!-- Topic Stats Container -->
            <div id="topic-stats-container">
                <table id="topic-stats-table">
                    <thead>
                        <tr>
                            <th>Topic</th>
                            <th>Last Msg Time<br>(ms ago)</th>
                            <th>Msg Rate<br>(Hz)</th>
                        </tr>
                    </thead>
                    <tbody id="topic-stats-table-body">
                        <!-- Javascript will populate this -->
                    </tbody>
                </table>
            </div>
        </div>

        <div id="container-row">
            <!-- ROS Logging Console -->
            <div id="ros-console" ></div>
        
            <!-- Log Level Filters -->
            <div id="log-level-filters">
                <div><input type="checkbox" id="log-level-10" class="log-level" unchecked> <label for="log-level-10">Debug</label></div>
                <div><input type="checkbox" id="log-level-20" class="log-level" checked> <label for="log-level-20">Info</label></div>
                <div><input type="checkbox" id="log-level-30" class="log-level" checked> <label for="log-level-30">Warn</label></div>
                <div><input type="checkbox" id="log-level-40" class="log-level" checked> <label for="log-level-40">Error</label></div>
                <div><input type="checkbox" id="log-level-50" class="log-level" checked> <label for="log-level-50">Fatal</label></div>
                <button id="clear-console-btn">Clear Console</button>
            </div>
        </div>
    </div>
</body>
</html>
